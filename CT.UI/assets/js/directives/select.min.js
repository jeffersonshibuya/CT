"use strict";app.factory("SelectFx",["$http",function(){function s(n,t){if(!n)return!1;for(var i=n.target||n.srcElement||n||!1;i&&i!=t;)i=i.parentNode||!1;return i!==!1}function f(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n}function n(n,t){this.el=n[0];this.options=f({},this.options);f(this.options,t);this._init()}function e(n){return new RegExp("(^|\\s+)"+n+"(\\s+|$)")}function o(n,t){var f=i(n,t)?u:r;f(n,t)}var i,r,u,t;return"classList"in document.documentElement?(i=function(n,t){return n.classList.contains(t)},r=function(n,t){n.classList.add(t)},u=function(n,t){n.classList.remove(t)}):(i=function(n,t){return e(t).test(n.className)},r=function(n,t){i(n,t)||(n.className=n.className+" "+t)},u=function(n,t){n.className=n.className.replace(e(t)," ")}),t={hasClass:i,addClass:r,removeClass:u,toggleClass:o,has:i,add:r,remove:u,toggle:o},typeof define=="function"&&define.amd?define(t):window.classie=t,n.prototype.options={newTab:!0,stickyPlaceholder:!0,onChange:function(){return!1}},n.prototype._init=function(){var t=!1,n;this.el.hasAttribute("disabled")&&(this.el.className=this.el.className+" disabled",t=!0);n=this.el.querySelector("option[selected]");this.hasDefaultPlaceholder=n&&n.disabled;this.selectedOpt=n||this.el.querySelector("option");this._createSelectEl();this.selOpts=[].slice.call(this.selEl.querySelectorAll("li[data-option]"));this.selOptsCount=this.selOpts.length;this.current=this.selOpts.indexOf(this.selEl.querySelector("li.cs-selected"))||-1;this.selPlaceholder=this.selEl.querySelector("span.cs-placeholder");t||this._initEvents()},n.prototype._createSelectEl=function(){var r=this,n="",t=function(n){var i="",t="",r="";return!n.selectedOpt||this.foundSelected||this.hasDefaultPlaceholder||(t+="cs-selected ",this.foundSelected=!0),n.getAttribute("data-class")&&(t+=n.getAttribute("data-class")),n.getAttribute("data-link")&&(r="data-link="+n.getAttribute("data-link")),t!==""&&(i='class="'+t+'" '),"<li "+i+r+' data-option data-value="'+n.value+'"><span>'+n.textContent+"<\/span><\/li>"},i;[].slice.call(this.el.children).forEach(function(i){if(!i.disabled){var r=i.tagName.toLowerCase();r==="option"?n+=t(i):r==="optgroup"&&(n+='<li class="cs-optgroup"><span>'+i.label+"<\/span><ul>",[].slice.call(i.children).forEach(function(i){n+=t(i)}),n+="<\/ul><\/li>")}});i='<div class="cs-options"><ul>'+n+"<\/ul><\/div>";this.selEl=document.createElement("div");this.selEl.className=this.el.className;this.selEl.tabIndex=this.el.tabIndex;this.selEl.innerHTML='<span class="cs-placeholder">'+this.selectedOpt.textContent+"<\/span>"+i;this.el.parentNode.appendChild(this.selEl);this.selEl.appendChild(this.el)},n.prototype._initEvents=function(){var n=this;this.selPlaceholder.addEventListener("click",function(){n._toggleSelect()});this.selOpts.forEach(function(t,i){t.addEventListener("click",function(){n.current=i;n._changeOption();n._toggleSelect()})});document.addEventListener("click",function(t){var i=t.target;n._isOpen()&&i!==n.selEl&&!s(i,n.selEl)&&n._toggleSelect()});this.selEl.addEventListener("keydown",function(t){var i=t.keyCode||t.which;switch(i){case 38:t.preventDefault();n._navigateOpts("prev");break;case 40:t.preventDefault();n._navigateOpts("next");break;case 32:t.preventDefault();n._isOpen()&&typeof n.preSelCurrent!="undefined"&&n.preSelCurrent!==-1&&n._changeOption();n._toggleSelect();break;case 13:t.preventDefault();n._isOpen()&&typeof n.preSelCurrent!="undefined"&&n.preSelCurrent!==-1&&(n._changeOption(),n._toggleSelect());break;case 27:t.preventDefault();n._isOpen()&&n._toggleSelect()}})},n.prototype._navigateOpts=function(n){this._isOpen()||this._toggleSelect();var i=typeof this.preSelCurrent!="undefined"&&this.preSelCurrent!==-1?this.preSelCurrent:this.current;(n==="prev"&&i>0||n==="next"&&i<this.selOptsCount-1)&&(this.preSelCurrent=n==="next"?i+1:i-1,this._removeFocus(),t.add(this.selOpts[this.preSelCurrent],"cs-focus"))},n.prototype._toggleSelect=function(){this._removeFocus();this._isOpen()?(this.current!==-1&&(this.selPlaceholder.textContent=this.selOpts[this.current].textContent),t.remove(this.selEl,"cs-active")):(this.hasDefaultPlaceholder&&this.options.stickyPlaceholder&&(this.selPlaceholder.textContent=this.selectedOpt.textContent),t.add(this.selEl,"cs-active"))},n.prototype._changeOption=function(){var n,r,i;typeof this.preSelCurrent!="undefined"&&this.preSelCurrent!==-1&&(this.current=this.preSelCurrent,this.preSelCurrent=-1);n=this.selOpts[this.current];this.selPlaceholder.textContent=n.textContent;this.el.value=n.getAttribute("data-value");r=new Event("change");this.el.dispatchEvent(r);i=this.selEl.querySelector("li.cs-selected");i&&t.remove(i,"cs-selected");t.add(n,"cs-selected");n.getAttribute("data-link")&&(this.options.newTab?window.open(n.getAttribute("data-link"),"_blank"):window.location=n.getAttribute("data-link"));this.options.onChange(this.el.value)},n.prototype._isOpen=function(){return t.has(this.selEl,"cs-active")},n.prototype._removeFocus=function(){var n=this.selEl.querySelector("li.cs-focus");n&&t.remove(n,"cs-focus")},n}]);app.directive("csSelect",["SelectFx",function(n){return{restrict:"AC",link:function(t,i){new n(i)}}}]);